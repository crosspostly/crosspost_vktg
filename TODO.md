# VK‚ÜíTelegram Crossposter - TODO List

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Ä–∞–∑–≤–∏—Ç–∏—è

### 1. ‚ùå –£–ë–†–ê–¢–¨ –í–ï–°–¨ –ö–ï–® - –ü–û–õ–ê–ì–ê–¢–¨–°–Ø –¢–û–õ–¨–ö–û –ù–ê –õ–ò–°–¢–´

**–ü—Ä–æ–±–ª–µ–º–∞:** –í client.gs –≤—Å—ë –µ—â—ë –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–µ—à `LAST_POST_IDS` –≤ UserProperties, —Ö–æ—Ç—è –∑–∞–¥–∞—á–∞ –±—ã–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –ª–∏—Å—Ç—ã —Å–æ–æ–±—â–µ—Å—Ç–≤–∞.

**–ß—Ç–æ —É–±—Ä–∞—Ç—å:**
- `getLastPostIds()` - —á—Ç–µ–Ω–∏–µ –∏–∑ Properties 
- `saveLastPostIds(ids)` - –∑–∞–ø–∏—Å—å –≤ Properties
- `LAST_POST_IDS` –≤ UserProperties

**–ß—Ç–æ –∑–∞–º–µ–Ω–∏—Ç—å:**
- `getLastPostIdFromSheet(bindingName, vkGroupId)` - –∏–∑ Published –ª–∏—Å—Ç–∞
- `saveLastPostIdToSheet(bindingName, vkGroupId, postId)` - –≤ Published –ª–∏—Å—Ç
- –í—Å—è –ª–æ–≥–∏–∫–∞ —á–µ—Ä–µ–∑ `getOrCreatePublishedPostsSheet()`

### 2. üîó –£–ª—É—á—à–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ ID –∏–∑ URL (CLIENT)

**–§—É–Ω–∫—Ü–∏—è:** `extractSheetNameFromVkUrl()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–º–µ–Ω–∏ –ª–∏—Å—Ç–∞

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã VK:**
- `https://vk.com/public123456` ‚Üí `public123456` 
- `https://vk.com/club789012` ‚Üí `club789012`
- `https://vk.com/durov` ‚Üí `durov`
- `https://vk.com/varsmana` ‚Üí `varsmana`
- `vk.com/apiclub` ‚Üí `apiclub`

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–º—è –¥–ª—è Google Sheets (—É–¥–∞–ª–µ–Ω–∏–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã (–º–∞–∫—Å–∏–º—É–º 27 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è `Published_Name`)
- Fallback –Ω–∞ VK Group ID –µ—Å–ª–∏ screen_name –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

### 3. üÜî –£–ª—É—á—à–∏—Ç—å —Ä–µ–∑–æ–ª–≤ screen_name –≤ ID (SERVER)

**–§—É–Ω–∫—Ü–∏–∏:** `extractVkGroupId()` + `resolveVkScreenName()`

**VK API –º–µ—Ç–æ–¥—ã —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**

#### `utils.resolveScreenName`
**URL:** `https://api.vk.com/method/utils.resolveScreenName`
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `screen_name` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è (apiclub, durov, rules_of_war)
- `v` (string) - –≤–µ—Ä—Å–∏—è API (5.131)
- `access_token` (string) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–æ–∫–µ–Ω

**–í–æ–∑–≤—Ä–∞—Ç:**
```json
{
  "response": {
    "type": "group",  // user, group, event, page, application, vk_app
    "object_id": 123456
  }
}
```

**–î–ª—è –≥—Ä—É–ø–ø:** –í–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π `object_id` –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º: `-123456`

#### `groups.getById`
**URL:** `https://api.vk.com/method/groups.getById`
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `group_ids` (string) - ID –∏–ª–∏ screen_name –≥—Ä—É–ø–ø (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
- `fields` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (name, screen_name, description)
- `v` (string) - –≤–µ—Ä—Å–∏—è API

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥—Ä—É–ø–ø –±–µ–∑ User Token (–ø—É–±–ª–∏—á–Ω—ã–π API)**

### 4. üì± –£–ª—É—á—à–∏—Ç—å Telegram Chat ID –æ–±—Ä–∞–±–æ—Ç–∫—É

**–§—É–Ω–∫—Ü–∏—è:** `extractTelegramChatId()` 

**Telegram Bot API - getChat method:**
**URL:** `https://api.telegram.org/bot<token>/getChat`
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `chat_id` (string/integer) - ID —á–∞—Ç–∞ –∏–ª–∏ @username –∫–∞–Ω–∞–ª–∞

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
- `@channelname` - username –∫–∞–Ω–∞–ª–∞
- `-1001234567890` - ID —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—ã/–∫–∞–Ω–∞–ª–∞
- `123456789` - ID –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —á–∞—Ç–∞
- `https://t.me/channelname` ‚Üí `@channelname`
- `t.me/username` ‚Üí `@username`

**–í–æ–∑–≤—Ä–∞—Ç getChat:**
```json
{
  "ok": true,
  "result": {
    "id": -1001234567890,
    "title": "Channel Name",
    "username": "channelname",
    "type": "channel"  // private, group, supergroup, channel
  }
}
```

### 5. ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã `getTelegramChatName()` –∏ `getVkGroupName()` (20-25 —Å–µ–∫)
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–≤—è–∑–æ–∫

**–†–µ—à–µ–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `bindingName` –≤–º–µ—Å—Ç–æ API –∑–∞–ø—Ä–æ—Å–æ–≤ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è –≤ ScriptProperties —Å TTL
- –ë–∞—Ç—á-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 6. üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**CLIENT (client.gs):**
- ‚úÖ –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Published –ª–∏—Å—Ç—ã (—É–±—Ä–∞—Ç—å Properties –∫–µ—à)
- ‚úÖ `extractSheetNameFromVkUrl()` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∏–º–µ–Ω –ª–∏—Å—Ç–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ Telegram —Ñ–æ—Ä–º–∞—Ç–æ–≤
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ UI

**SERVER (server.gs):**
- ‚úÖ –¢–æ—á–Ω—ã–π `extractVkGroupId()` —Å `utils.resolveScreenName`
- ‚úÖ –ü—É–±–ª–∏—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø —á–µ—Ä–µ–∑ `groups.getById`
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π —Å TTL
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –£–±—Ä–∞—Ç—å –∫–µ—à Properties
1. –ó–∞–º–µ–Ω–∏—Ç—å `getLastPostIds()` ‚Üí `getLastPostIdFromSheet()`
2. –ó–∞–º–µ–Ω–∏—Ç—å `saveLastPostIds()` ‚Üí `saveLastPostIdToSheet()` 
3. –û–±–Ω–æ–≤–∏—Ç—å `checkNewPosts()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–∏—Å—Ç–∞–º–∏
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ Properties –∫–µ—à–∞

### –≠—Ç–∞–ø 2: URL Processing (CLIENT)
1. –°–æ–∑–¥–∞—Ç—å `extractSheetNameFromVkUrl()` –¥–ª—è –∏–º–µ–Ω –ª–∏—Å—Ç–æ–≤
2. –û–±–Ω–æ–≤–∏—Ç—å `getOrCreatePublishedPostsSheet()` 
3. –£–ª—É—á—à–∏—Ç—å `extractTelegramChatId()` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π t.me —Å—Å—ã–ª–æ–∫

### –≠—Ç–∞–ø 3: ID Resolution (SERVER)  
1. –£–ª—É—á—à–∏—Ç—å `extractVkGroupId()` —Å fallback –Ω–∞ API
2. –î–æ–±–∞–≤–∏—Ç—å `resolveVkScreenName()` —á–µ—Ä–µ–∑ `utils.resolveScreenName`
3. –ü—É–±–ª–∏—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø —á–µ—Ä–µ–∑ `groups.getById`
4. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö URL —Ñ–æ—Ä–º–∞—Ç–æ–≤
2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–ù–ò–ö–ê–ö–û–ì–û Properties –∫–µ—à–∞** - —Ç–æ–ª—å–∫–æ –ª–∏—Å—Ç—ã Published
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–≤—è–∑–∫–∞–º–∏  
- **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–º–µ–Ω–∞ –ª–∏—Å—Ç–æ–≤** (–±–µ–∑ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤, –ª–∏–º–∏—Ç –¥–ª–∏–Ω—ã)
- **Graceful fallback** –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
- **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üìù –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ URL –≤–∞—Ä–∏–∞–Ω—Ç—ã

### VK (–í–ö–æ–Ω—Ç–∞–∫—Ç–µ)
```
‚úÖ https://vk.com/public123456
‚úÖ https://vk.com/club789012  
‚úÖ https://vk.com/durov
‚úÖ https://vk.com/varsmana
‚úÖ vk.com/apiclub
‚úÖ VK.COM/PUBLIC999888
‚úÖ -123456 (–ø—Ä—è–º–æ–π ID)
‚úÖ 123456 (–ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ -123456)
```

### Telegram
```
‚úÖ https://t.me/channelname
‚úÖ t.me/username  
‚úÖ @channelname
‚úÖ channelname (–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è @)
‚úÖ -1001234567890 (–≥—Ä—É–ø–ø–æ–≤–æ–π chat_id)
‚úÖ 123456789 (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π chat_id)
```

## üèÅ –¶–µ–ª—å

**–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫—Ä–æ—Å—Å–ø–æ—Å—Ç–∏–Ω–≥–∞:**
- –ë–µ–∑ Properties –∫–µ—à–∞ (—Ç–æ–ª—å–∫–æ Published –ª–∏—Å—Ç—ã)
- –° –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—Å–µ—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö URL —Ñ–æ—Ä–º–∞—Ç–æ–≤
- –ë—ã—Å—Ç—Ä–∞—è –∏ –Ω–∞–¥—ë–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Å—ã–ª–æ–∫
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ error handling
