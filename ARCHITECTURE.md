# VK‚ÜíTelegram Crossposter - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üö´ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û

**–ï–î–ò–ù–°–¢–í–ï–ù–ù–´–ô –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã** –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é –ø–æ—Å—Ç–∏–Ω–≥–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ VK ‚Äî —ç—Ç–æ **–õ–ò–°–¢ Published_{BindingName}** –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ù–ò–ö–ê–ö–û–ì–û –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è** –≤ PropertiesService / CacheService –¥–ª—è:
- –ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–æ–æ–±—â–µ—Å—Ç–≤ VK
- –ü–æ—Å–ª–µ–¥–Ω–∏—Ö ID –ø–æ—Å—Ç–æ–≤
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–æ–≤
- –ü—Ä–µ–≤—å—é –∏ —Å—Å—ã–ª–æ–∫ –Ω–∞ –ø–æ—Å—Ç—ã

**–ê–±—Å–æ–ª—é—Ç–Ω–æ. –õ—é–±—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî –ß–ò–¢–ê–¢–¨/–ü–ò–°–ê–¢–¨ –¢–û–õ–¨–ö–û –í –õ–ò–°–¢–´ Published.**

---

## üèóÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
1. **CLIENT.gs** - –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (Google Sheets UI + –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)
2. **SERVER.gs** - –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (Google Apps Script Web App)
3. **Published –ª–∏—Å—Ç—ã** - –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã
- **Serverless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –í–µ—Å—å –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ Google Apps Script
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: –û–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í—Å–µ —Ç–æ–∫–µ–Ω—ã VK –∏ Telegram —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- **–õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**: –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–µ –∫–ª—é—á–∏

---

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
VK API ‚Üê SERVER.gs ‚Üí Telegram API
   ‚Üë         ‚Üì           ‚Üì
   ‚îî‚îÄ‚îÄ USER TOKEN    BOT TOKEN
           ‚Üë             ‚Üì
      CLIENT.gs ‚Üê‚Üí Google Sheets
           ‚Üë             ‚Üì
      USER LICENSE ‚Üí Published –ª–∏—Å—Ç—ã
```

### –ü—Ä–æ—Ü–µ—Å—Å –∫—Ä–æ—Å—Å–ø–æ—Å—Ç–∏–Ω–≥–∞
1. **CLIENT**: –¢—Ä–∏–≥–≥–µ—Ä –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `checkNewPosts()`
2. **CLIENT**: –ò–∑–≤–ª–µ–∫–∞–µ—Ç `vk_group_id` –∏–∑ URL –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `handleGetVkPosts(vk_group_id)`
3. **SERVER**: –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç `vk_group_id` –∏ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Å—Ç—ã –∏–∑ VK API —Å User Token
4. **CLIENT**: –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ ID –≤ Published –ª–∏—Å—Ç–∞—Ö —Ñ–æ—Ä–º–∞—Ç–∞ `Published_{BindingName}`
5. **SERVER**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã –≤ Telegram —á–µ—Ä–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–µ–¥–∏–∞-—Å—Ç—Ä–∞—Ç–µ–≥–∏—é
6. **CLIENT**: –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã –≤ Published –ª–∏—Å—Ç—ã —Å VK Post URL
7. **SERVER**: –ö–µ—à–∏—Ä—É–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è VK/TG –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (`getCachedVkGroupName`, `getCachedTelegramChatName`)

---

## üíæ –°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### üß≠ –ü—Ä–∞–≤–∏–ª–∞ Published –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–ª—è –∫–∞–∂–¥–æ–π —Å–≤—è–∑–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ª–∏—Å—Ç —Å –∏–º–µ–Ω–µ–º, **—Å—Ç—Ä–æ–≥–æ —Ä–∞–≤–Ω—ã–º bindingName** (–Ω–∏–∫–∞–∫–∏—Ö –ø—Ä–∏—Å—Ç–∞–≤–æ–∫ –∏–ª–∏ —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤).
- –ù–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è **—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞** (—Å—Ç—Ä–æ–∫–∞ 2), —á—Ç–æ–±—ã —Å–∞–º—ã–µ —Å–≤–µ–∂–∏–µ –ø–æ—Å—Ç—ã –∏ –ª–æ–≥–∏ –≤—Å–µ–≥–¥–∞ –±—ã–ª–∏ **–≤–∏–¥–Ω—ã –Ω–∞–≤–µ—Ä—Ö—É –ª–∏—Å—Ç–∞**.
- Dev note: `sheet.insertRowAfter(1)` ‚Üí BindingName ‚Äî –∏–º—è –ª–∏—Å—Ç–∞; –Ω–æ–≤—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ ‚Äî —Å—Ç—Ä–æ–∫–∞ 2 (–≤–µ—Ä—Ö –ª–∏—Å—Ç–∞).

### ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å –≥–∏–±—Ä–∏–¥–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:** –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Published –ª–∏—Å—Ç–∞—Ö, –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–µ—à –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

```javascript
// ‚úÖ –û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ - Published –ª–∏—Å—Ç—ã:
function getLastPostIdFromSheet(bindingName, vkGroupId)
function saveLastPostIdToSheet(bindingName, vkGroupId, postId)

// ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–π –∫–µ—à - –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π –≥—Ä—É–ø–ø/–∫–∞–Ω–∞–ª–æ–≤:
function getCachedVkGroupName(vkGroupId)      // CacheService TTL 6 —á–∞—Å–æ–≤
function getCachedTelegramChatName(chatId)   // CacheService TTL 6 —á–∞—Å–æ–≤
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–µ—à–∞:**
- **–ù–∞–∑–≤–∞–Ω–∏—è VK –≥—Ä—É–ø–ø**: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ API –≤—ã–∑–æ–≤—ã –∫ groups.getById
- **–ù–∞–∑–≤–∞–Ω–∏—è TG –∫–∞–Ω–∞–ª–æ–≤**: –∏–∑–±–µ–≥–∞–µ—Ç –∏–∑–ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ getChat
- **–ù–ï –∫–µ—à–∏—Ä—É–µ—Ç—Å—è**: ID –ø–æ—Å—Ç–æ–≤, –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

### ‚úÖ –¢—Ä—ë—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑ Properties –∫–µ—à–∞

#### –£—Ä–æ–≤–µ–Ω—å 1: –ü–∞–º—è—Ç—å (CacheService) - –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ
- **–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã**: `SYSTEM_LOGS` —Å TTL 24 —á–∞—Å–∞
- **–°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–æ–±—Ä–∞–±–æ—Ç–∫–∏**: `AUTO_PROCESSING_STATUS`
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: –î–æ 6 —á–∞—Å–æ–≤ (–ª–∏–º–∏—Ç Google Apps Script)

#### –£—Ä–æ–≤–µ–Ω—å 2: Published –ª–∏—Å—Ç—ã - –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤
- **–§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏**: `bindingName` (—Å—Ç—Ä–æ–≥–æ –±–µ–∑ –ø—Ä–∏—Å—Ç–∞–≤–æ–∫ –∏ —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤, –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤)
- **–ö–æ–ª–æ–Ω–∫–∏**: Post ID, Sent At, TG Chat Name, Status, Source, Post Preview, VK Post URL
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –∞—É–¥–∏—Ç –æ—Ç–ø—Ä–∞–≤–æ–∫

#### –£—Ä–æ–≤–µ–Ω—å 3: –°–µ—Ä–≤–µ—Ä - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–õ–∏—Å—Ç Licenses**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–õ–∏—Å—Ç Bindings**: –°–≤—è–∑–∫–∏ VK‚ÜíTelegram —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –≤–∫–ª—é—á–∞—è `Binding Name` –∏ `Binding Description`
- **–õ–∏—Å—Ç Logs**: –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
- **ScriptProperties**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤ (BOT_TOKEN, VK_USER_ACCESS_TOKEN)
- **–ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: `migrateBindingsSheet()` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ª–∏—Å—Ç–æ–≤

---

## üö´ –ö–†–ò–¢–ò–ß–ù–û #12: VK –í–ò–î–ï–û ‚Äî –ü–†–Ø–ú–´–ï –§–ê–ô–õ–´

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞
- –û—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è embed —Å—Å—ã–ª–∫–∏ `video_ext.php` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø—Ä—è–º–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ –¥–ª—è Telegram

### ‚úÖ –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ VK API video.get
**–ú–µ—Ç–æ–¥:** `video.get` ([–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://dev.vk.com/method/video.get))

**–ó–∞–ø—Ä–æ—Å:**
```
GET https://api.vk.com/method/video.get
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- videos: "{owner_id}_{video_id}" (–Ω–∞–ø—Ä–∏–º–µ—Ä: "-22822305_456242110")
- v: "5.131"
- access_token: USER_TOKEN (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)

–û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ files:
{
  "response": {
    "items": [{
      "files": {
        "mp4_720": "https://vk.com/video_file_720p_url",
        "mp4_480": "https://vk.com/video_file_480p_url", 
        "mp4_360": "https://vk.com/video_file_360p_url",
        "hls": "https://vk.com/hls_stream_url"
      }
    }]
  }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–∞—á–µ—Å—Ç–≤–∞:** `mp4_720` ‚Üí `mp4_480` ‚Üí `mp4_360` ‚Üí `hls` (–∫—Ä–∞–π–Ω–∏–π —Å–ª—É—á–∞–π)

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ SERVER.gs

```javascript
function getVkVideoDirectUrl(videoId) {
  try {
    const userToken = PropertiesService.getScriptProperties().getProperty("VK_USER_ACCESS_TOKEN");
    if (!userToken) return null;
    
    const response = UrlFetchApp.fetch(
      `https://api.vk.com/method/video.get?videos=${encodeURIComponent(videoId)}&v=5.131&access_token=${userToken}`,
      { muteHttpExceptions: true, timeout: 15000 }
    );
    
    const data = JSON.parse(response.getContentText());
    if (data.error || !data.response?.items?.[0]?.files) return null;
    
    const files = data.response.items[0].files;
    const qualities = ['mp4_720', 'mp4_480', 'mp4_360', 'hls'];
    
    for (const quality of qualities) {
      if (files[quality]) return files[quality];
    }
    
    return null;
  } catch (error) {
    logEvent("ERROR", "video_direct_url_error", "server", `Video ${videoId}: ${error.message}`);
    return null;
  }
}
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
**–ú–µ—Ç–æ–¥:** `sendVideo` ([–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://core.telegram.org/bots/api#sendvideo))

**–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞:**
```
POST https://api.telegram.org/bot<TOKEN>/sendVideo
Content-Type: application/json

{
  "chat_id": "-1001234567890",
  "video": "https://direct_video_url.mp4",
  "caption": "–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞",
  "parse_mode": "Markdown",
  "supports_streaming": true
}
```

**–î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (>50MB):** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å multipart/form-data –≤–º–µ—Å—Ç–æ URL

---

## üö´ –ö–†–ò–¢–ò–ß–ù–û #13: –ú–ï–î–ò–ê–ì–†–£–ü–ü–´ –ò –°–ú–ï–®–ê–ù–ù–´–ô –ö–û–ù–¢–ï–ù–¢

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞
- –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ –æ–¥–Ω–æ–º—É
- –°–º–µ—à–∞–Ω–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–∏—è –¥—Ä–æ–±—è—Ç—Å—è –Ω–∞ –º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π

### ‚úÖ –°—Ç—Ä–∞—Ç–µ–≥–∏—è "–º–∏–Ω–∏–º—É–º —Å–æ–æ–±—â–µ–Ω–∏–π"

#### Telegram –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- **MediaGroup**: —Ç–æ–ª—å–∫–æ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ –û–î–ù–û–ì–û —Ç–∏–ø–∞ (—Ç–æ–ª—å–∫–æ —Ñ–æ—Ç–æ –ò–õ–ò —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ)
- **–ú–∞–∫—Å–∏–º—É–º**: 10 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ MediaGroup
- **Caption**: —Ç–æ–ª—å–∫–æ —É –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ MediaGroup
- **–°–º–µ—à–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç**: —Ç—Ä–µ–±—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤

#### –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏:

1. **–¢–æ–ª—å–∫–æ —Ñ–æ—Ç–æ** (1-10 —à—Ç):
   ```
   1 –∑–∞–ø—Ä–æ—Å: sendMediaGroup(photos[], caption –≤ –ø–µ—Ä–≤–æ–º)
   ```

2. **–¢–æ–ª—å–∫–æ –≤–∏–¥–µ–æ** (1 —à—Ç):
   ```  
   1 –∑–∞–ø—Ä–æ—Å: sendVideo(direct_url, caption)
   ```

3. **–¢–æ–ª—å–∫–æ –≤–∏–¥–µ–æ** (>1 —à—Ç):
   ```
   N –∑–∞–ø—Ä–æ—Å–æ–≤: sendVideo –¥–ª—è –∫–∞–∂–¥–æ–≥–æ (caption —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–≤–æ–º)
   ```

4. **–§–æ—Ç–æ + –≤–∏–¥–µ–æ**:
   ```
   –í–∞—Ä–∏–∞–Ω—Ç A (1 –≤–∏–¥–µ–æ + ‚â§9 —Ñ–æ—Ç–æ):
   - sendVideo(video_url, caption) 
   - sendMediaGroup(photos[], –±–µ–∑ caption)
   
   –í–∞—Ä–∏–∞–Ω—Ç B (>1 –≤–∏–¥–µ–æ):
   - sendVideo –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–µ–æ
   - sendMediaGroup(photos[], –±–µ–∑ caption)
   ```

5. **–î–æ–∫—É–º–µ–Ω—Ç—ã/–∞—É–¥–∏–æ**:
   ```
   –û—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: sendDocument(), sendAudio()
   ```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ SERVER.gs

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è MediaGroup ‚úÖ

**sendMixedMediaOptimized()** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –¥–æ 10 —Ñ–æ—Ç–æ –≤ –æ–¥–∏–Ω MediaGroup
- –≠–∫–æ–Ω–æ–º–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤: –≤–º–µ—Å—Ç–æ N –∑–∞–ø—Ä–æ—Å–æ–≤ = 1 –∑–∞–ø—Ä–æ—Å
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: —É—Å–∫–æ—Ä–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ N —Ä–∞–∑
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ sendVkPostToTelegram()

**–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:**
- 10 —Ñ–æ—Ç–æ = 1 API –∑–∞–ø—Ä–æ—Å (—ç–∫–æ–Ω–æ–º–∏—è 90%)
- 20 —Ñ–æ—Ç–æ = 2 API –∑–∞–ø—Ä–æ—Å–∞ (—ç–∫–æ–Ω–æ–º–∏—è 90%)

```javascript
function sendMixedMediaOptimized(botToken, chatId, mediaUrls, caption, options) {
  // –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç —Ñ–æ—Ç–æ –ø–æ MAX_MEDIA_GROUP_SIZE (10)
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞–∂–¥—É—é –≥—Ä—É–ø–ø—É –û–î–ù–ò–ú –∑–∞–ø—Ä–æ—Å–æ–º
  // –í–∏–¥–µ–æ –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
  // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
}
```

### –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

```javascript
function sendMixedMediaOptimized(botToken, chatId, mediaData, caption) {
  const { photos, videos, docLinks, audioLinks } = mediaData;
  const results = [];
  
  try {
    // 1. –í–∏–¥–µ–æ –ø–µ—Ä–≤—ã–º–∏ (—Å caption —Ç–æ–ª—å–∫–æ —É –ø–µ—Ä–≤–æ–≥–æ)
    for (let i = 0; i < videos.length; i++) {
      const videoCaption = (i === 0 && !photos.length) ? caption : null;
      const result = sendTelegramVideo(botToken, chatId, videos[i].url, videoCaption);
      results.push(result);
    }
    
    // 2. –§–æ—Ç–æ –≥—Ä—É–ø–ø–æ–π (caption —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ –≤–∏–¥–µ–æ)
    if (photos.length > 0) {
      const photoCaption = videos.length === 0 ? caption : null;
      const result = sendTelegramMediaGroup(botToken, chatId, photos, photoCaption);
      results.push(result);
    }
    
    // 3. –¢–µ–∫—Å—Ç –æ—Ç–¥–µ–ª—å–Ω–æ –µ—Å–ª–∏ –±—ã–ª —Ç–æ–ª—å–∫–æ –≤ caption –∏ –º–µ–¥–∏–∞ –µ–≥–æ "—Å—ä–µ–ª–æ"
    if (caption && videos.length === 0 && photos.length === 0) {
      const result = sendTelegramMessage(botToken, chatId, caption);
      results.push(result);
    }
    
    // 4. –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –∞—É–¥–∏–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
    // (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è sendDocument/sendAudio...)
    
    return {
      success: results.every(r => r.success),
      message_ids: results.filter(r => r.success).map(r => r.message_id),
      errors: results.filter(r => !r.success).map(r => r.error)
    };
    
  } catch (error) {
    return { success: false, error: error.message };
  }
}

function sendTelegramVideo(token, chatId, videoUrl, caption) {
  const payload = {
    chat_id: chatId,
    video: videoUrl,
    caption: caption || undefined,
    parse_mode: caption ? 'Markdown' : undefined,
    supports_streaming: true
  };
  
  const response = UrlFetchApp.fetch(`https://api.telegram.org/bot${token}/sendVideo`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    payload: JSON.stringify(payload),
    muteHttpExceptions: true,
    timeout: 30000
  });
  
  const result = JSON.parse(response.getContentText());
  
  return result.ok 
    ? { success: true, message_id: result.result.message_id }
    : { success: false, error: result.description };
}
```

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π getVkMediaUrls()

```javascript
function getVkMediaUrls(attachments) {
  const result = {
    photos: [],
    videos: [],      // ‚Üê –ò–∑–º–µ–Ω–µ–Ω–æ: direct URLs —á–µ—Ä–µ–∑ video.get
    docLinks: [],
    audioLinks: []
  };
  
  for (const attachment of attachments) {
    switch (attachment.type) {
      case "photo":
        const photoUrl = getBestPhotoUrl(attachment.photo.sizes);
        if (photoUrl) result.photos.push({ type: "photo", url: photoUrl });
        break;
        
      case "video":
        const videoId = `${attachment.video.owner_id}_${attachment.video.id}`;
        const directUrl = getVkVideoDirectUrl(videoId);  // ‚Üê –ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ!
        
        if (directUrl) {
          result.videos.push({ type: "video", url: directUrl, id: videoId });
        } else {
          // Fallback –Ω–∞ embed –µ—Å–ª–∏ direct URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
          result.docLinks.push(`üé• [–í–∏–¥–µ–æ](https://vk.com/video${videoId})`);
        }
        break;
        
      // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    }
  }
  
  return result;
}
```

---

## üîó URL Processing –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ ID

### CLIENT: extractSheetNameFromVkUrl()
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∏–º—ë–Ω –ª–∏—Å—Ç–æ–≤ –∏–∑ VK URL

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
```
‚úÖ https://vk.com/public123456 ‚Üí "public123456"
‚úÖ https://vk.com/club789012 ‚Üí "club789012"  
‚úÖ https://vk.com/durov ‚Üí "durov"
‚úÖ https://vk.com/varsmana ‚Üí "varsmana"
‚úÖ vk.com/apiclub ‚Üí "apiclub"
‚úÖ VK.COM/PUBLIC999888 ‚Üí "public999888"
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –£–¥–∞–ª–µ–Ω–∏–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è Google Sheets: `[^\w\s\-_–∞-—è–ê-–Ø—ë–Å]`
- –ó–∞–º–µ–Ω–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –Ω–∞ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏—è: `\s+` ‚Üí `_`
- –õ–∏–º–∏—Ç –¥–ª–∏–Ω—ã: 27 —Å–∏–º–≤–æ–ª–æ–≤ (–¥–ª—è `Published_Name`)
- Fallback –Ω–∞ VK Group ID –µ—Å–ª–∏ screen_name –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```javascript
function extractSheetNameFromVkUrl(url) {
  if (!url) return null;
  
  const cleanUrl = url.trim().toLowerCase().split('?')[0].split('#')[0];
  
  // public123456, club789012
  const idMatch = cleanUrl.match(/(?:public|club)(\d+)/);
  if (idMatch) return `${idMatch[0]}`;
  
  // durov, varsmana, apiclub
  const nameMatch = cleanUrl.match(/vk\.com\/([a-z0-9_]+)/);
  if (nameMatch) {
    return nameMatch[1]
      .replace(/[^\w\s\-_–∞-—è–ê-–Ø—ë–Å]/g, '')
      .replace(/\s+/g, '_')
      .substring(0, 27);
  }
  
  return null;
}
```

### SERVER: extractVkGroupId() + resolveVkScreenName()
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–æ—á–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ VK Group ID —á–µ—Ä–µ–∑ API

**VK API utils.resolveScreenName** ([–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://dev.vk.com/method/utils.resolveScreenName)):
```
GET https://api.vk.com/method/utils.resolveScreenName
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- screen_name: "durov", "apiclub", "varsmana"
- v: "5.131" 
- access_token: USER_TOKEN

–û—Ç–≤–µ—Ç:
{
  "response": {
    "type": "group",  // user, group, event, page
    "object_id": 123456
  }
}
```

**–õ–æ–≥–∏–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:**
- –î–ª—è –≥—Ä—É–ø–ø: –¥–æ–±–∞–≤–ª—è–µ–º –º–∏–Ω—É—Å ‚Üí `-123456`
- –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å ‚Üí `123456`

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```javascript
function resolveVkScreenName(screenName) {
  const userToken = PropertiesService.getScriptProperties().getProperty("VK_USER_ACCESS_TOKEN");
  
  const response = UrlFetchApp.fetch(
    `https://api.vk.com/method/utils.resolveScreenName?screen_name=${screenName}&v=5.131&access_token=${userToken}`,
    { muteHttpExceptions: true, timeout: 10000 }
  );
  
  const data = JSON.parse(response.getContentText());
  
  if (data.error) throw new Error(`VK API Error: ${data.error.error_msg}`);
  if (!data.response) throw new Error(`Not found: ${screenName}`);
  
  const objectId = data.response.object_id;
  const type = data.response.type;
  
  return (type === 'group' || type === 'page') ? `-${objectId}` : objectId.toString();
}
```

### CLIENT: extractTelegramChatId()
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö Telegram —Ñ–æ—Ä–º–∞—Ç–æ–≤

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
```
‚úÖ @channelname ‚Üí "@channelname"
‚úÖ https://t.me/channelname ‚Üí "@channelname"
‚úÖ t.me/username ‚Üí "@username"  
‚úÖ channelname ‚Üí "@channelname"
‚úÖ -1001234567890 ‚Üí "-1001234567890"
‚úÖ 123456789 ‚Üí "123456789"
```

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```javascript
function extractTelegramChatId(input) {
  if (!input) throw new Error('Empty Telegram input');
  
  const cleanInput = input.trim();
  
  // –£–∂–µ chat_id (—á–∏—Å–ª–æ)
  if (/^-?\d+$/.test(cleanInput)) return cleanInput;
  
  // –ò–∑–≤–ª–µ–∫–∞–µ–º username –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
  const patterns = [
    /t\.me\/([a-z0-9_]+)/i,  // t.me/username
    /@([a-z0-9_]+)/i,        // @username
    /^([a-z0-9_]+)$/i        // username
  ];
  
  for (const pattern of patterns) {
    const match = cleanInput.match(pattern);
    if (match) return '@' + match[1];
  }
  
  throw new Error('Invalid Telegram format: ' + input);
}
```

---

## üîÑ –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ API Endpoints

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ API:
- **handleGetVkPosts()**: —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `vk_group_id` (–Ω–µ —Ç–æ–ª—å–∫–æ `vk_group_url`)
- **handlePublishLastPost()**: –Ω–æ–≤—ã–π endpoint –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Å—Ç–∞
- **getUserBindingsWithNames()**: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤—è–∑–∫–∏ —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏

### Enhanced API Flow:
```javascript
// CLIENT ‚Üí SERVER –∑–∞–ø—Ä–æ—Å—ã
POST /exec
{
  "event": "get_vk_posts",
  "license_key": "...",
  "vk_group_id": "-123456",  // ‚Üê –ù–û–í–û–ï: –ø—Ä—è–º–æ–π ID –≤–º–µ—Å—Ç–æ URL
  "count": 50
}

POST /exec  
{
  "event": "publish_last_post",  // ‚Üê –ù–û–í–´–ô endpoint
  "license_key": "...",
  "vk_group_id": "-123456",
  "binding_id": "binding_123"
}
```

---

## üõ†Ô∏è API Reference

### VK API –ú–µ—Ç–æ–¥—ã

#### utils.resolveScreenName
**URL:** `https://api.vk.com/method/utils.resolveScreenName`
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `screen_name` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è
- `v` (string) - –≤–µ—Ä—Å–∏—è API (5.131)
- `access_token` (string) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–æ–∫–µ–Ω

**–û—Ç–≤–µ—Ç:**
```json
{
  "response": {
    "type": "group|user|event|page|application|vk_app",
    "object_id": 123456
  }
}
```

#### video.get
**URL:** `https://api.vk.com/method/video.get`
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `videos` (string) - ID –≤–∏–¥–µ–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "{owner_id}_{video_id}"
- `v` (string) - –≤–µ—Ä—Å–∏—è API
- `access_token` (string) - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ç–æ–∫–µ–Ω (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)

**–û—Ç–≤–µ—Ç —Å –ø—Ä—è–º—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏:**
```json
{
  "response": {
    "items": [{
      "files": {
        "mp4_720": "https://...direct_url_720p.mp4",
        "mp4_480": "https://...direct_url_480p.mp4",
        "mp4_360": "https://...direct_url_360p.mp4",
        "hls": "https://...stream.m3u8"
      },
      "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ",
      "duration": 180
    }]
  }
}
```

### Telegram Bot API –ú–µ—Ç–æ–¥—ã

#### sendVideo
**URL:** `https://api.telegram.org/bot<token>/sendVideo`
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `chat_id` (string) - ID —á–∞—Ç–∞
- `video` (string) - URL —Ñ–∞–π–ª–∞ –∏–ª–∏ InputFile
- `caption` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –ø–æ–¥–ø–∏—Å—å –¥–æ 1024 —Å–∏–º–≤–æ–ª–æ–≤
- `parse_mode` (string) - "Markdown" –∏–ª–∏ "HTML"
- `supports_streaming` (boolean) - true –¥–ª—è –≤–∏–¥–µ–æ

#### sendMediaGroup  
**URL:** `https://api.telegram.org/bot<token>/sendMediaGroup`
**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –¢–æ–ª—å–∫–æ —Ñ–æ—Ç–æ –ò–õ–ò —Ç–æ–ª—å–∫–æ –≤–∏–¥–µ–æ (–Ω–µ —Å–º–µ—à–∏–≤–∞—Ç—å)
- –ú–∞–∫—Å–∏–º—É–º 10 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- Caption —Ç–æ–ª—å–∫–æ —É –ø–µ—Ä–≤–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "chat_id": "-1001234567890",
  "media": [
    {
      "type": "photo",
      "media": "https://photo1.jpg",
      "caption": "–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞",
      "parse_mode": "Markdown"
    },
    {
      "type": "photo", 
      "media": "https://photo2.jpg"
    }
  ]
}
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: VK –ø–æ—Å—Ç —Å 5 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏
**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
1. `getVkMediaUrls()` ‚Üí `photos: [url1, url2, url3, url4, url5]`
2. `sendMixedMediaOptimized()` ‚Üí 1 –∑–∞–ø—Ä–æ—Å `sendMediaGroup`
3. –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram —Å –º–µ–¥–∏–∞–≥—Ä—É–ø–ø–æ–π

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: VK –ø–æ—Å—Ç —Å –≤–∏–¥–µ–æ + 3 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏  
**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
1. `getVkMediaUrls()` ‚Üí `videos: [direct_url]`, `photos: [url1, url2, url3]`
2. `sendMixedMediaOptimized()` ‚Üí `sendVideo` + `sendMediaGroup`
3. –†–µ–∑—É–ª—å—Ç–∞—Ç: 2 —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: VK –ø–æ—Å—Ç —Ç–æ–ª—å–∫–æ —Å —Ç–µ–∫—Å—Ç–æ–º
**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
1. `formatVkPostForTelegram()` ‚Üí –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
2. `sendTelegramMessage()` ‚Üí 1 –∑–∞–ø—Ä–æ—Å
3. –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

---

## üîß Google Apps Script —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞

### Multipart –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤–∏–¥–µ–æ
```javascript
function sendVideoMultipart(token, chatId, videoUrl, caption) {
  // –°–∫–∞—á–∏–≤–∞–µ–º –≤–∏–¥–µ–æ
  const videoBlob = UrlFetchApp.fetch(videoUrl).getBlob();
  
  if (videoBlob.getSize() > 50 * 1024 * 1024) { // >50MB
    throw new Error("Video too large for Telegram (50MB limit)");
  }
  
  // –§–æ—Ä–º–∏—Ä—É–µ–º multipart payload
  const boundary = "----formdata-apps-script-" + Utilities.getUuid();
  const payloadParts = [
    `--${boundary}`,
    'Content-Disposition: form-data; name="chat_id"',
    '', 
    chatId,
    `--${boundary}`,
    'Content-Disposition: form-data; name="video"; filename="video.mp4"',
    'Content-Type: video/mp4',
    '',
    videoBlob.getBytes(),
    `--${boundary}--`
  ];
  
  return UrlFetchApp.fetch(`https://api.telegram.org/bot${token}/sendVideo`, {
    method: 'POST',
    headers: { 'Content-Type': `multipart/form-data; boundary=${boundary}` },
    payload: payloadParts.join('\r\n'),
    muteHttpExceptions: true
  });
}
```

### Rate limiting –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
```javascript
let lastApiCall = 0;
const API_DELAY = 100; // –º—Å –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

function rateLimitedFetch(url, options) {
  const now = Date.now();
  const timeSinceLastCall = now - lastApiCall;
  
  if (timeSinceLastCall < API_DELAY) {
    Utilities.sleep(API_DELAY - timeSinceLastCall);
  }
  
  lastApiCall = Date.now();
  return UrlFetchApp.fetch(url, options);
}
```

---

## üéØ –ü–ª–∞–Ω—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –£–±—Ä–∞—Ç—å Properties –∫–µ—à ‚úÖ
- [x] –£–¥–∞–ª–∏—Ç—å `getLastPostIds()` / `saveLastPostIds()` 
- [x] –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `getLastPostIdFromSheet()` / `saveLastPostIdToSheet()`
- [x] –û–±–Ω–æ–≤–∏—Ç—å `checkNewPosts()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–∏—Å—Ç–∞–º–∏

### –≠—Ç–∞–ø 2: URL Processing ‚úÖ  
- [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `extractSheetNameFromVkUrl()` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∏–º—ë–Ω
- [x] –£–ª—É—á—à–∏—Ç—å `extractVkGroupId()` —Å fallback –Ω–∞ API
- [x] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤—Å–µ—Ö Telegram —Ñ–æ—Ä–º–∞—Ç–æ–≤

### –≠—Ç–∞–ø 3: –í–∏–¥–µ–æ –∏ –º–µ–¥–∏–∞–≥—Ä—É–ø–ø—ã üîÑ
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `getVkVideoDirectUrl()` —á–µ—Ä–µ–∑ `video.get`
- [ ] –°–æ–∑–¥–∞—Ç—å `sendMixedMediaOptimized()` —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å multipart –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç–∞

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è üìã
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è URL extraction
- [ ] Integration —Ç–µ—Å—Ç—ã –¥–ª—è –º–µ–¥–∏–∞-–æ—Ç–ø—Ä–∞–≤–∫–∏  
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ README —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- [ ] –ß–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [VK API Reference](https://dev.vk.com/method) - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Telegram Bot API](https://core.telegram.org/bots/api) - –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤
- [Google Apps Script](https://developers.google.com/apps-script) - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- [UrlFetchApp](https://developers.google.com/apps-script/reference/url-fetch) - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è GAS

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –ª–∏—Å—Ç "Logs" —Å —É—Ä–æ–≤–Ω—è–º–∏:
- **ERROR** - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- **WARN** - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è  
- **INFO** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- **DEBUG** - –ø–æ–¥—Ä–æ–±–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ (—Ç–æ–ª—å–∫–æ –≤ DEV_MODE)

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ VK API
- –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö/–Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç–∞

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 2025-11-04*