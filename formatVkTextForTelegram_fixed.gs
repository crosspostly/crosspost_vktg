function formatVkTextForTelegram(text, options) {
  if (!text) return "";
  
  options = options || {};
  var boldFirstLine = options.boldFirstLine !== false; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true
  var boldUppercase = options.boldUppercase !== false; // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true
  
  // ‚úÖ –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø –ü–ï–†–ï–ù–û–°–û–í –°–¢–†–û–ö - –ö–†–ò–¢–ò–ß–ï–°–ö–û –î–õ–Ø TELEGRAM HTML
  // VK –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –ø–µ—Ä–µ–Ω–æ—Å–æ–≤: \r\n, \r, \n
  // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ –≤ \n –¥–ª—è Telegram HTML —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  text = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
  
  // ‚úÖ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê: –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–≤–æ–π–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã –∫–∞–∫ –∞–±–∑–∞—Ü—ã
  // Telegram HTML –ª—É—á—à–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–≤–æ–π–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
  text = text.replace(/\n\n+/g, '\n\n'); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã
  
  // üîç DEBUG: –õ–æ–≥–∏—Ä—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏
  if (text.indexOf('\n') !== -1) {
    logEvent("DEBUG", "vk_text_with_linebreaks", "server", 
             `Text length: ${text.length}, Line breaks: ${(text.match(/\n/g) || []).length}, First 100 chars: ${text.substring(0, 100).replace(/\n/g, '\\n')}`);
  }
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ - –ù–ï —É–¥–∞–ª—è–µ–º –∏—Ö!
  // Telegram HTML –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç \n –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫
  
  // ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ô –ü–û–†–Ø–î–û–ö –û–ë–†–ê–ë–û–¢–ö–ò - –ì–ò–ü–ï–†–°–°–´–õ–ö–ò –ü–ï–†–í–´–ï, –ó–ê–¢–ï–ú –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï
   
  // 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ [id123|–ò–º—è] - –°–ê–ú–´–ô –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
  text = text.replace(/\[id(\d+)\|([^\]]+)\]/g, '<a href="https://vk.com/id$1">$2</a>');
  
  // 2. –ì—Ä—É–ø–ø—ã [club123|–ì—Ä—É–ø–ø–∞] –∏ [public123|–ü–∞–±–ª–∏–∫] - –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
  text = text.replace(/\[(club|public)(\d+)\|([^\]]+)\]/g, function(match, type, id, title) {
    return `<a href="https://vk.com/${type}${id}">${title}</a>`;
  });
  
  // 3. ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô: VK —Å—Å—ã–ª–∫–∏ –ë–ï–ó –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ [vk.com/...|—Ç–µ–∫—Å—Ç] - –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
  text = text.replace(/\[vk\.com\/([^\]|]+)\|([^\]]+)\]/g, '<a href="https://vk.com/$1">$2</a>');
  
  // 4. VK —Å—Å—ã–ª–∫–∏ –° –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º [https://vk.com/...|text] - –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
  text = text.replace(/\[(https?:\/\/vk\.com\/[^\]|]+)\|([^\]]+)\]/g, '<a href="$1">$2</a>');
  
  // 5. ‚úÖ –ù–û–í–´–ô: –û–±—â–∏–µ –≤–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏ [https://...|text] –∏ [http://...|text] - –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
  text = text.replace(/\[(https?:\/\/[^\]|]+)\|([^\]]+)\]/g, '<a href="$1">$2</a>');
  
  // 6. ‚úÖ –ù–û–í–´–ô: –û–±—â–∏–µ —Å—Å—ã–ª–∫–∏ –±–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ [example.com|text] - –°–ê–ú–´–ô –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
  text = text.replace(/\[([^\]|]+\.[a-zA-Z]{2,}[^\|]*)\|([^\]]+)\]/g, '<a href="https://$1">$2</a>');
  
  // 7. –î–µ–ª–∞–µ–º –∂–∏—Ä–Ω—ã–º –ø–µ—Ä–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ) - –ü–û–°–õ–ï –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–∏–ø–µ—Ä—Å—Å—ã–ª–æ–∫!
  if (boldFirstLine) {
    text = text.replace(/^([^.!?]*[.!?])/, '<b>$1</b>');
  }
  
  // 8. –î–µ–ª–∞–µ–º –∂–∏—Ä–Ω—ã–º–∏ —Å–ª–æ–≤–∞ –≤ –í–ï–†–•–ù–ï–ú –†–ï–ì–ò–°–¢–†–ï (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ) - –ü–û–°–õ–ï –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–∏–ø–µ—Ä—Å—Å—ã–ª–æ–∫!
  if (boldUppercase) {
    text = text.replace(/\b[–ê-–ØA-Z]{2,}\b/g, '<b>$&</b>');
  }
  
  // –ù–ï —É–¥–∞–ª—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –∏ –ù–ï —Å–æ–∫—Ä–∞—â–∞–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ VK –ø–æ—Å—Ç–∞
  
  // üîç DEBUG: –õ–æ–≥–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  if (text.indexOf('\n') !== -1) {
    logEvent("DEBUG", "formatted_text_with_linebreaks", "server", 
             `Final text length: ${text.length}, Line breaks: ${(text.match(/\n/g) || []).length}, First 100 chars: ${text.substring(0, 100).replace(/\n/g, '\\n')}`);
  }
  
  return text;
}